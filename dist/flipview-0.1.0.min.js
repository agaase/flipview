/*! flipview.js - v0.1.0 - 2014-06-15
* https://github.com/agaase/
* Copyright (c) 2014 agaase; Licensed MIT */
var flipview=function(){var a=".flipTile",b=function(a){this.flipArea=a,this.flipEle=$(".flipView",this.flipArea),this.rotAngle=0,this.tileIds=[-1,0,1],c.call(this),d.call(this)},c=function(){this.flipArea.css("-webkit-perspective","1000"),this.flipEle.css("-webkit-transform-style","preserve-3d"),$(a,this.flipEle).css("-webkit-backface-visibility","hidden")},d=function(){$(".back",this.flipEle).hide().css("-webkit-transform","rotateY(-180deg)"),h.call(this)},e=function(a){var b=$(".next",this.flipEle),c=$(".front",this.flipEle),d=$(".prev",this.flipEle);0>a?(this.tileIds[0]=this.tileIds[1],this.tileIds[1]=this.tileIds[2],this.tileIds[2]=this.tileIds[1]+1<20?this.tileIds[1]+1:-1,b.removeClass("next back").addClass("front"),d.removeClass("prev").addClass("next"),c.removeClass("front").addClass("back prev")):(this.tileIds[2]=this.tileIds[1],this.tileIds[1]=this.tileIds[0],this.tileIds[0]=this.tileIds[0]-1,b.removeClass("next").addClass("prev"),d.removeClass("prev back").addClass("front"),c.removeClass("front").addClass("back next"))},f=function(a){this.rotAngle+=180*a;var b=this.rotAngle;this.flipEle.css({"-webkit-transform":"rotateY("+b+"deg)","transition-duration":"1s","transition-timing-function":"linear"}),setTimeout(function(){e.call(this,a),0>a&&this.tileIds[2]>-1?(this.onFlipNext(),$(".next",this.flipEle).css("-webkit-transform","rotateY("+this.tileIds[2]%2*180+"deg)")):this.tileIds[0]>-1&&(this.onFlipPrev(),$(".prev",this.flipEle).css("-webkit-transform","rotateY("+this.tileIds[2]%2*180+"deg)"))}.bind(this),1e3)},g=function(a,b){var c=this.rotAngle+a;b>0?(c=c<this.rotAngle?this.rotAngle:c,c-this.rotAngle>180&&(c=this.rotAngle+180)):0>=b&&(c=c>this.rotAngle?this.rotAngle:c,this.rotAngle-c>180&&(c=this.rotAngle-180));var d=6*Math.abs(c-this.rotAngle)/1e3;d=d>.05?d:.05,this.flipEle.css({"-webkit-transform":"rotateY("+c+"deg)","transition-duration":""+d+"s","transition-timing-function":"linear"})},h=function(){var a,b,c,d=10,e=!0,h=function(a){var d=a.originalEvent.changedTouches[0];b=d.pageX,c=d.pageX}.bind(this),i=function(a){a.preventDefault();var f=a.originalEvent.changedTouches[0];Math.abs(f.pageX-c)<d,c=f.pageX,(550>b&&-1!==this.tileIds[0]||b>650&&-1!==this.tileIds[2])&&(e&&(550>b?($(".prev",this.flipEle).show(),$(".next",this.flipEle).hide()):b>650&&($(".next",this.flipEle).show(),$(".prev",this.flipEle).hide()),setTimeout(function(){g.call(this,(f.pageX-b)/2,550>b?1:-1)}.bind(this),50),e=!1),g.call(this,(f.pageX-b)/3,550>b?1:-1))}.bind(this),j=function(c){c.preventDefault(),a&&clearTimeout(a),a=setTimeout(function(){var a=c.originalEvent.changedTouches[0];a.pageX-b<-100&&b>800&&-1!==this.tileIds[2]?(e&&($(".next",this.flipEle).show(),$(".prev",this.flipEle).hide()),setTimeout(function(){f.call(this,-1),e=!0}.bind(this),50),e=!0):a.pageX-b>100&&400>b&&-1!==this.tileIds[0]?(e&&($(".prev",this.flipEle).show(),$(".next",this.flipEle).hide()),setTimeout(function(){f.call(this,1),e=!0}.bind(this),50)):(g.call(this,0,1),this.flipEle.css({"transition-duration":"1s"}),e=!0)}.bind(this),50)}.bind(this);this.flipArea.on("touchstart",h).on("touchmove",i).on("touchend",j)};return b}();