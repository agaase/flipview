/*! flipview.js - v0.1.0 - 2014-06-19
* https://github.com/agaase/
* Copyright (c) 2014 agaase; Licensed MIT */
var flipview=function(){var a=".flipView",b={fast:400,slow:2e3},c=function(a,b){this.params=b||{},this.flipArea=a,this.flipEle=$(".flipView",this.flipArea),this.rotAngle=0,this.slideIds=[-1,0,1],e.call(this),f.call(this),d.call(this)},d=function(){var a=parseInt(this.params.speed);a||(a=("string"==typeof this.params.speed?b[this.params.speed]:1e3)||1e3),this.params.speed=a/1e3},e=function(){this.flipEle.css("position","relative").append("<div class='front'></div>").append("<div class='next'></div>").append($("<div class='prev'></div>")),this.flipArea.css("-webkit-perspective","1000"),this.flipEle.css("-webkit-transform-style","preserve-3d"),$(a+" > div").css({"-webkit-backface-visibility":"hidden",position:"absolute",height:"100%",width:"100%"}).addClass("flipSlide"),$(".next,.prev",this.flipEle).hide().css("-webkit-transform","rotateY(-180deg)")},f=function(){var a,b,c,d=10,e=!0,f=function(a){var d=a.originalEvent.changedTouches[0];b=d.pageX,c=d.pageX}.bind(this),g=function(a){a.preventDefault();var f=a.originalEvent.changedTouches[0];Math.abs(f.pageX-c)<d,c=f.pageX,(550>b&&-1!==this.slideIds[0]||b>650&&-1!==this.slideIds[2])&&(e&&(550>b?($(".prev",this.flipEle).show(),$(".next",this.flipEle).hide()):b>650&&($(".next",this.flipEle).show(),$(".prev",this.flipEle).hide()),setTimeout(function(){i.call(this,(f.pageX-b)/2,550>b?1:-1)}.bind(this),50),e=!1),i.call(this,(f.pageX-b)/3,550>b?1:-1))}.bind(this),j=function(c){c.preventDefault(),a&&clearTimeout(a),a=setTimeout(function(){var a=c.originalEvent.changedTouches[0];a.pageX-b<-100&&b>800&&-1!==this.slideIds[2]?(e&&($(".next",this.flipEle).show(),$(".prev",this.flipEle).hide()),setTimeout(function(){h.call(this,-1),e=!0}.bind(this),50),e=!0):a.pageX-b>100&&400>b&&-1!==this.slideIds[0]?(e&&($(".prev",this.flipEle).show(),$(".next",this.flipEle).hide()),setTimeout(function(){h.call(this,1),e=!0}.bind(this),50)):(i.call(this,0,1),this.flipEle.css({"transition-duration":this.params.speed+"s"}),e=!0)}.bind(this),50)}.bind(this);this.flipArea.on("touchstart",f).on("touchmove",g).on("touchend",j)},g=function(a){var b=$(".next",this.flipEle),c=$(".front",this.flipEle),d=$(".prev",this.flipEle);0>a?(this.slideIds[0]=this.slideIds[1],this.slideIds[1]=this.slideIds[2],this.slideIds[2]=this.slideIds[1]+1<20?this.slideIds[1]+1:-1,b.removeClass("next").addClass("front"),d.removeClass("prev").addClass("next"),c.removeClass("front").addClass("prev")):(this.slideIds[2]=this.slideIds[1],this.slideIds[1]=this.slideIds[0],this.slideIds[0]=this.slideIds[0]-1,b.removeClass("next").addClass("prev"),d.removeClass("prev").addClass("front"),c.removeClass("front").addClass("next"))},h=function(a){this.beforeFlip&&this.beforeFlip(a),this.rotAngle+=180*a;var b=this.rotAngle;this.flipEle.css({"-webkit-transform":"rotateY("+b+"deg)","transition-duration":this.params.speed+"s","transition-timing-function":"linear"}),setTimeout(function(){g.call(this,a),0>a&&this.slideIds[2]>-1?(this.onFlipNext(),$(".next",this.flipEle).css("-webkit-transform","rotateY("+this.slideIds[2]%2*180+"deg)")):this.slideIds[0]>-1&&(this.onFlipPrev(),$(".prev",this.flipEle).css("-webkit-transform","rotateY("+this.slideIds[2]%2*180+"deg)"))}.bind(this),1e3)},i=function(a,b){var c=this.rotAngle+a;b>0?(c=c<this.rotAngle?this.rotAngle:c,c-this.rotAngle>180&&(c=this.rotAngle+180)):0>=b&&(c=c>this.rotAngle?this.rotAngle:c,this.rotAngle-c>180&&(c=this.rotAngle-180));var d=this.params.speed/180*Math.abs(c-this.rotAngle);this.flipEle.css({"-webkit-transform":"rotateY("+c+"deg)","transition-duration":""+d+"s","transition-timing-function":"linear"})};return c}();